<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: SagaRollback Pages: 1 -->
<svg width="701pt" height="657pt"
 viewBox="0.00 0.00 700.61 657.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 653)">
<title>SagaRollback</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-653 696.61,-653 696.61,4 -4,4"/>
<text text-anchor="middle" x="346.3" y="-633.8" font-family="Times,serif" font-size="14.00">Triggering a Rollback of the Entire Saga</text>
<g id="clust1" class="cluster">
<title>cluster_Compensating</title>
<polygon fill="none" stroke="blue" stroke-dasharray="5,2" points="180.5,-8 180.5,-229 502.5,-229 502.5,-8 180.5,-8"/>
<text text-anchor="middle" x="341.5" y="-213.8" font-family="Times,serif" font-size="14.00">Compensating transactions</text>
</g>
<!-- OrderFulfillment -->
<g id="node1" class="node">
<title>OrderFulfillment</title>
<ellipse fill="lightblue" stroke="black" cx="134.5" cy="-608" rx="72.78" ry="18"/>
<text text-anchor="middle" x="134.5" y="-604.9" font-family="Times,serif" font-size="12.00">Order fulfillment</text>
</g>
<!-- CheckStock -->
<g id="node2" class="node">
<title>CheckStock</title>
<polygon fill="lightblue" stroke="black" points="269,-553 0,-553 0,-517 269,-517 269,-553"/>
<text text-anchor="middle" x="134.5" y="-531.9" font-family="Times,serif" font-size="12.00">Check item in stock and reserve for order</text>
</g>
<!-- OrderFulfillment&#45;&gt;CheckStock -->
<g id="edge1" class="edge">
<title>OrderFulfillment&#45;&gt;CheckStock</title>
<path fill="none" stroke="black" d="M134.5,-589.81C134.5,-581.79 134.5,-572.05 134.5,-563.07"/>
<polygon fill="black" stroke="black" points="138,-563.03 134.5,-553.03 131,-563.03 138,-563.03"/>
</g>
<!-- TakeMoney -->
<g id="node3" class="node">
<title>TakeMoney</title>
<polygon fill="lightblue" stroke="black" points="403.5,-480 221.5,-480 221.5,-444 403.5,-444 403.5,-480"/>
<text text-anchor="middle" x="312.5" y="-458.9" font-family="Times,serif" font-size="12.00">Take money from customer</text>
</g>
<!-- CheckStock&#45;&gt;TakeMoney -->
<g id="edge2" class="edge">
<title>CheckStock&#45;&gt;TakeMoney</title>
<path fill="none" stroke="black" d="M177.14,-516.99C202.05,-507.06 233.69,-494.43 260.12,-483.89"/>
<polygon fill="black" stroke="black" points="261.6,-487.07 269.6,-480.11 259.01,-480.57 261.6,-487.07"/>
</g>
<!-- Warehouse -->
<g id="node7" class="node">
<title>Warehouse</title>
<polygon fill="lightgrey" stroke="black" points="172.5,-180 143,-198 84,-198 54.5,-180 84,-162 143,-162 172.5,-180"/>
<text text-anchor="middle" x="113.5" y="-176.9" font-family="Times,serif" font-size="12.00">Warehouse</text>
</g>
<!-- CheckStock&#45;&gt;Warehouse -->
<g id="edge6" class="edge">
<title>CheckStock&#45;&gt;Warehouse</title>
<path fill="none" stroke="darkgreen" stroke-dasharray="5,2" d="M129.96,-516.92C126.57,-502.62 122.5,-481.63 122.5,-463 122.5,-463 122.5,-463 122.5,-287 122.5,-260.14 119.6,-229.59 117.09,-208.21"/>
<polygon fill="darkgreen" stroke="darkgreen" points="120.55,-207.72 115.86,-198.22 113.6,-208.57 120.55,-207.72"/>
<text text-anchor="middle" x="163.5" y="-371.3" font-family="Times,serif" font-size="14.00">Handled by</text>
</g>
<!-- AwardPoints -->
<g id="node4" class="node">
<title>AwardPoints</title>
<polygon fill="lightblue" stroke="black" points="399,-393 226,-393 226,-357 399,-357 399,-393"/>
<text text-anchor="middle" x="312.5" y="-371.9" font-family="Times,serif" font-size="12.00">Award points to customer</text>
</g>
<!-- TakeMoney&#45;&gt;AwardPoints -->
<g id="edge3" class="edge">
<title>TakeMoney&#45;&gt;AwardPoints</title>
<path fill="none" stroke="black" d="M312.5,-443.8C312.5,-432.16 312.5,-416.55 312.5,-403.24"/>
<polygon fill="black" stroke="black" points="316,-403.18 312.5,-393.18 309,-403.18 316,-403.18"/>
</g>
<!-- PaymentGateway -->
<g id="node8" class="node">
<title>PaymentGateway</title>
<polygon fill="lightgrey" stroke="black" points="594.2,-375 549.85,-393 461.15,-393 416.8,-375 461.15,-357 549.85,-357 594.2,-375"/>
<text text-anchor="middle" x="505.5" y="-371.9" font-family="Times,serif" font-size="12.00">Payment Gateway</text>
</g>
<!-- TakeMoney&#45;&gt;PaymentGateway -->
<g id="edge7" class="edge">
<title>TakeMoney&#45;&gt;PaymentGateway</title>
<path fill="none" stroke="darkgreen" stroke-dasharray="5,2" d="M351.56,-443.8C382.13,-430.33 424.81,-411.54 457.47,-397.15"/>
<polygon fill="darkgreen" stroke="darkgreen" points="459.09,-400.26 466.83,-393.03 456.27,-393.86 459.09,-400.26"/>
<text text-anchor="middle" x="461.5" y="-414.8" font-family="Times,serif" font-size="14.00">Handled by</text>
</g>
<!-- PackageOrder -->
<g id="node5" class="node">
<title>PackageOrder</title>
<polygon fill="lightcoral" stroke="black" points="394,-306 231,-306 231,-270 394,-270 394,-306"/>
<text text-anchor="middle" x="312.5" y="-284.9" font-family="Times,serif" font-size="12.00">Package and send order</text>
</g>
<!-- AwardPoints&#45;&gt;PackageOrder -->
<g id="edge4" class="edge">
<title>AwardPoints&#45;&gt;PackageOrder</title>
<path fill="none" stroke="black" d="M312.5,-356.8C312.5,-345.16 312.5,-329.55 312.5,-316.24"/>
<polygon fill="black" stroke="black" points="316,-316.18 312.5,-306.18 309,-316.18 316,-316.18"/>
</g>
<!-- Loyalty -->
<g id="node9" class="node">
<title>Loyalty</title>
<polygon fill="lightgrey" stroke="black" points="500.64,-288 478.57,-306 434.43,-306 412.36,-288 434.43,-270 478.57,-270 500.64,-288"/>
<text text-anchor="middle" x="456.5" y="-284.9" font-family="Times,serif" font-size="12.00">Loyalty</text>
</g>
<!-- AwardPoints&#45;&gt;Loyalty -->
<g id="edge8" class="edge">
<title>AwardPoints&#45;&gt;Loyalty</title>
<path fill="none" stroke="darkgreen" stroke-dasharray="5,2" d="M341.64,-356.8C365.06,-342.97 398,-323.53 422.6,-309.01"/>
<polygon fill="darkgreen" stroke="darkgreen" points="424.42,-312 431.25,-303.9 420.86,-305.97 424.42,-312"/>
<text text-anchor="middle" x="433.5" y="-327.8" font-family="Times,serif" font-size="14.00">Handled by</text>
</g>
<!-- FulfillmentCompleted -->
<g id="node6" class="node">
<title>FulfillmentCompleted</title>
<ellipse fill="lightblue" stroke="black" cx="601.5" cy="-180" rx="91.21" ry="18"/>
<text text-anchor="middle" x="601.5" y="-176.9" font-family="Times,serif" font-size="12.00">Fulfillment completed</text>
</g>
<!-- PackageOrder&#45;&gt;FulfillmentCompleted -->
<g id="edge5" class="edge">
<title>PackageOrder&#45;&gt;FulfillmentCompleted</title>
<path fill="none" stroke="black" d="M389.79,-269.99C410.36,-264.84 432.43,-258.74 452.5,-252 477.23,-243.7 482.85,-240 506.5,-229 524.88,-220.45 544.95,-210.42 561.89,-201.74"/>
<polygon fill="black" stroke="black" points="563.66,-204.77 570.94,-197.08 560.45,-198.54 563.66,-204.77"/>
</g>
<!-- PackageOrder&#45;&gt;Warehouse -->
<g id="edge9" class="edge">
<title>PackageOrder&#45;&gt;Warehouse</title>
<path fill="none" stroke="darkgreen" stroke-dasharray="5,2" d="M264.13,-269.93C237.46,-259.65 204.23,-245.39 176.5,-229 164.45,-221.88 152.02,-212.83 141.42,-204.52"/>
<polygon fill="darkgreen" stroke="darkgreen" points="143.35,-201.58 133.36,-198.06 138.97,-207.04 143.35,-201.58"/>
<text text-anchor="middle" x="260.5" y="-240.8" font-family="Times,serif" font-size="14.00">Handled by</text>
</g>
<!-- RemoveStock -->
<g id="node10" class="node">
<title>RemoveStock</title>
<polygon fill="lightgrey" stroke="black" points="443.44,-180 381.97,-198 259.03,-198 197.56,-180 259.03,-162 381.97,-162 443.44,-180"/>
<text text-anchor="middle" x="320.5" y="-176.9" font-family="Times,serif" font-size="12.00">Remove stock reservation</text>
</g>
<!-- PackageOrder&#45;&gt;RemoveStock -->
<g id="edge12" class="edge">
<title>PackageOrder&#45;&gt;RemoveStock</title>
<path fill="none" stroke="red" stroke-width="2" d="M313.79,-269.97C315.04,-253.38 316.96,-227.88 318.43,-208.43"/>
<polygon fill="red" stroke="red" stroke-width="2" points="321.93,-208.58 319.19,-198.34 314.95,-208.05 321.93,-208.58"/>
<text text-anchor="middle" x="382" y="-240.8" font-family="Times,serif" font-size="14.00">Rollback triggered</text>
</g>
<!-- RefundCustomer -->
<g id="node11" class="node">
<title>RefundCustomer</title>
<polygon fill="lightgrey" stroke="black" points="473.64,-107 404.07,-125 264.93,-125 195.36,-107 264.93,-89 404.07,-89 473.64,-107"/>
<text text-anchor="middle" x="334.5" y="-103.9" font-family="Times,serif" font-size="12.00">Give money back to customer</text>
</g>
<!-- RemoveStock&#45;&gt;RefundCustomer -->
<g id="edge10" class="edge">
<title>RemoveStock&#45;&gt;RefundCustomer</title>
<path fill="none" stroke="darkgreen" stroke-dasharray="5,2" d="M323.89,-161.81C325.47,-153.79 327.39,-144.05 329.16,-135.07"/>
<polygon fill="darkgreen" stroke="darkgreen" points="332.64,-135.52 331.14,-125.03 325.77,-134.16 332.64,-135.52"/>
</g>
<!-- RevokePoints -->
<g id="node12" class="node">
<title>RevokePoints</title>
<polygon fill="lightgrey" stroke="black" points="494.15,-34 417.83,-52 265.17,-52 188.85,-34 265.17,-16 417.83,-16 494.15,-34"/>
<text text-anchor="middle" x="341.5" y="-30.9" font-family="Times,serif" font-size="12.00">Take points away from customer</text>
</g>
<!-- RefundCustomer&#45;&gt;RevokePoints -->
<g id="edge11" class="edge">
<title>RefundCustomer&#45;&gt;RevokePoints</title>
<path fill="none" stroke="darkgreen" stroke-dasharray="5,2" d="M336.19,-88.81C336.99,-80.79 337.95,-71.05 338.83,-62.07"/>
<polygon fill="darkgreen" stroke="darkgreen" points="342.32,-62.32 339.82,-52.03 335.36,-61.64 342.32,-62.32"/>
</g>
</g>
</svg>
